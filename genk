ANDROID_TOP_DIR=$PWD
OUT_PUT_DIR="out/target/product/sabresd_6dq"
KERNEL_OBJ_DIR="out/target/product/sabresd_6dq/obj/KERNEL"

#mkdir -p out/target/product/sabresd_6dq/obj/KERNEL

cp=$ANDROID_TOP_DIR/prebuilts/gcc/linux-x86/arm/arm-eabi-4.6/bin/arm-eabi-
#cp kernel_imx/firmware/imx/sdma/sdma-imx6q-to1.bin $OUT_PUT_DIR/obj/KERNEL/firmware/imx/sdma/

#make ARCH=arm CROSS_COMPILE=$cp O=$ANDROID_TOP_DIR/$KERNEL_OBJ_DIR -C kernel_imx imx6_android_defconfig

make O=$ANDROID_TOP_DIR/$OUT_PUT_DIR/obj/KERNEL -C $ANDROID_TOP_DIR/kernel_imx -j8 uImage modules ARCH=arm CROSS_COMPILE=$cp

#rm -f include/config/kernel.release

#echo "3.0.35$(/bin/bash /home/zhangt/lw/push_dir/imx6dl/kernel_imx/scripts/setlocalversion /home/zhangt/lw/push_dir/imx6dl/kernel_imx)" > include/config/kernel.release

install -D $ANDROID_TOP_DIR/$KERNEL_OBJ_DIR/arch/arm/boot/uImage  $ANDROID_TOP_DIR/$OUT_PUT_DIR/uImage
install -D $ANDROID_TOP_DIR/$KERNEL_OBJ_DIR/arch/arm/boot/zImage  $ANDROID_TOP_DIR/$OUT_PUT_DIR/kernel

$ANDROID_TOP_DIR/out/host/linux-x86/bin/acp -fp $ANDROID_TOP_DIR/device/fsl/sabresd_6dq/fstab.freescale $ANDROID_TOP_DIR/$OUT_PUT_DIR/root/fstab.freescale

echo "Target boot image: $OUT_PUT_DIR/boot.img"

$ANDROID_TOP_DIR/out/host/linux-x86/bin/mkbootimg  --kernel $ANDROID_TOP_DIR/$OUT_PUT_DIR/kernel --ramdisk $ANDROID_TOP_DIR/$OUT_PUT_DIR/ramdisk.img --cmdline "console=ttymxc0,115200 init=/init video=mxcfb0:dev=ldb,bpp=32 video=mxcfb1:off video=mxcfb2:off fbmem=10M fb0base=0x27b00000 vmalloc=400M androidboot.console=ttymxc0 androidboot.hardware=freescale" --base 0x10800000  --output $ANDROID_TOP_DIR/$OUT_PUT_DIR/boot.img
