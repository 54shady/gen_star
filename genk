# run the script on the kernel src top directory

# marco
ANDROID_TOP_DIR="/home/zeroway/3288/51/src/3288_5.1"
KERNEL_OUT_DIR=$ANDROID_TOP_DIR/out/target/product/rk3288/obj/KERNEL

#################### A BRANCH OF CRAP START ####################
# build prepare
mkdir -p $KERNEL_OUT_DIR/drivers/gpu/arm/mali400/ump/linux
mkdir -p $KERNEL_OUT_DIR/drivers/gpu/arm/mali400/mali/linux
mkdir -p $KERNEL_OUT_DIR/drivers/net/wireless/rockchip_wlan/wifi_sys
mkdir -p $KERNEL_OUT_DIR/drivers/gpu/arm/mali400/mali/include/linux/mali
cp -rfd drivers/gpu/arm/mali400/ump/linux/license $KERNEL_OUT_DIR/drivers/gpu/arm/mali400/ump/linux/license
cp -rfd drivers/gpu/arm/mali400/mali/linux/license $KERNEL_OUT_DIR/drivers/gpu/arm/mali400/mali/linux/license
cp logo_kernel.bmp $KERNEL_OUT_DIR/
cp logo.bmp $KERNEL_OUT_DIR/

# copy the suck files
ALL_SUCK_FILES=(
"drivers/gpu/arm/mali400/ump/arch-pb-virtex5/config.h"
"drivers/gpu/arm/mali400/ump/arch-pb-virtex5-m400-4/config.h"
"drivers/gpu/arm/mali400/ump/arch-default/config.h"
"drivers/gpu/arm/mali400/ump/arch/config.h"
)

for file in ${ALL_SUCK_FILES[@]}
do
	if [ -f $file ]; then
		dst_dir_tmp=${file%/*}
		dst_dir=$KERNEL_OUT_DIR/${dst_dir_tmp#/*}
		echo "dest dir ==>" $dst_dir
		if [ ! -d ${dst_dir} ]; then
			mkdir -p ${dst_dir}
		fi

		cp -rvfd $file $KERNEL_OUT_DIR/$file
	fi
done

#################### A BRANCH OF CRAP END ####################

#################### THE REAL WORK START ####################
make ARCH=arm CROSS_COMPILE=/home/zeroway/3288/51/src/3288_5.1/prebuilts/gcc/linux-x86/arm/arm-eabi-4.6/bin/arm-eabi- O=$KERNEL_OUT_DIR rk3288_fc14.img -j32
#################### THE REAL WORK END ####################
