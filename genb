#!/bin/bash
# run this script on the android source code top dir

ANDROID_TOP_DIR=$PWD
ANDROID_OUT_DIR="$ANDROID_TOP_DIR/out/target/product/rk3399_firefly_box"
IMAGE_PATH="$ANDROID_TOP_DIR/rockdev/Image-rk3399_firefly_box/"
RAMDISK_IMG="ramdisk.img"
BOOT_IMG="boot.img"

# utils
MKBOOTFS="$ANDROID_TOP_DIR/out/host/linux-x86/bin/mkbootfs"
RK_MKKRNLIMG="$ANDROID_TOP_DIR/rkst/mkkrnlimg"
MINIGZIP="$ANDROID_TOP_DIR/out/host/linux-x86/bin/minigzip"

echo "Creating boot.img..."
$MKBOOTFS $ANDROID_OUT_DIR/root | $MINIGZIP > $ANDROID_OUT_DIR/$RAMDISK_IMG && \
	truncate -s "%4" $ANDROID_OUT_DIR/$RAMDISK_IMG && \
$RK_MKKRNLIMG $ANDROID_OUT_DIR/$RAMDISK_IMG $IMAGE_PATH/$BOOT_IMG >/dev/null
